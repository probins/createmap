import e from"./placesearch.htm.js";import t from"./component.js";import{$ as n}from"../../utils.js";import"./toolbar.js";import{transform as o}from"../../deps.js";import a from"../../olMap.js";const l=new t(e,"placesearch");n("#components-content").appendChild(l.getTemplate("placesearch"));const s=a.get();n("#placesearchbutton").addEventListener("click",(function(){const e=document.getElementById("searchfor").value,t=document.getElementById("placesearchapi").value,n=document.getElementById("placesearchcontinent").value;let a="https://secure.geonames.org/searchJSON?maxRows=10&username="+t+"&isNameRequired=true&style=full&q="+e;function l(e,t){let n=[e,t];const a=s.get("view");n=o(n,"EPSG:4326",a.getProjection());const l=a.extent;l[0]<=n[0]&&n[0]<=l[2]&&l[1]<=n[1]&&n[1]<=l[3]?(a.setCenter(n),a.setZoom(a.zoomIn)):alert("Coordinate outside map extent")}function r(e){l(parseFloat(this.dataset.lng),parseFloat(this.dataset.lat)),e.preventDefault()}n&&(a+="&continentCode="+n),a=a.replace(/amp;/g,""),fetch(a).then((e=>e.json())).then((e=>function(e){if(null===e)return void alert("Nothing returned from geonames.org");const t=e.geonames;if(0===t.length)return void alert("No such place on geonames.org");let n,o;if(1==t.length)n=parseFloat(t[0].lat),o=parseFloat(t[0].lng),l(o,n);else{let e="";for(let a=0;a<t.length;a++){const l=t[a];n=l.lat,o=l.lng,e+='<a href="#" class="gotos" data-lat="'+n+'" data-lng="'+o+'">'+l.name+", "+l.adminName1+", "+l.adminName2+", "+l.adminName3+", "+l.adminName4+"</a><br />"}document.getElementById("searchResults").innerHTML=e;const a=document.querySelectorAll(".gotos");for(let e=0;e<a.length;e++)a[e].addEventListener("click",r)}}(e))).catch((e=>{console.log(e),alert("Placesearch failed")}))}));