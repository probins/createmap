import e from"./placesearch.htm.js";import t from"./component.js";var a=new t(e,"placesearch");import r from"../../utils.js";var n=r.$;import"./toolbar.js";n("#components-content").appendChild(a.getTemplate("placesearch"));import o from"../../ext/ol.js";import l from"../../olMap.js";var s=l.get();n("#placesearchbutton").addEventListener("click",(function(){var e=document.getElementById("searchfor").value;var t=document.getElementById("placesearchapi").value;var a=document.getElementById("placesearchcontinent").value;var n="https://secure.geonames.org/searchJSON?maxRows=10&username="+t+"&isNameRequired=true&style=full&q="+e;if(a){n+="&continentCode="+a}n=n.replace(/amp;/g,"");var l=function(e,t){var a=[e,t];a=o.proj.transform(a,"EPSG:4326",s.get("view").getProjection());var r=s.get("view").extent;if(!(r[0]<=a[0]&&a[0]<=r[2]&&r[1]<=a[1]&&a[1]<=r[3])){alert("Coordinate outside map extent")}else{s.get("view").setCenter(a);s.get("view").setZoom(s.get("view").zoomIn)}};var c=function(){l(parseFloat(this.dataset.lng),parseFloat(this.dataset.lat))};var i=function(e){if(e===null){alert("Nothing returned from geonames.org");return}var t=e.geonames;if(t.length===0){alert("No such place on geonames.org");return}var a,r;if(t.length==1){a=parseFloat(t[0].lat);r=parseFloat(t[0].lng);l(r,a)}else{var n="";for(var o=0;o<t.length;o++){var s=t[o];a=s.lat;r=s.lng;var i=s.name+", "+s.adminName1+", "+s.adminName2+", "+s.adminName3+", "+s.adminName4;n+='<a href="#" class="gotos" data-lat="'+a+'" data-lng="'+r+'">'+i+"</a><br />"}document.getElementById("searchResults").innerHTML=n;var m=document.querySelectorAll(".gotos");for(var g=0;g<m.length;g++){m[g].addEventListener("click",c)}}};fetch(n).then((function(e){return e.json()})).then((function(e){i(e)})).catch((function(){r.errors.fetchFail()}))}));