import e from"../../utils.js";var o=e.$;import t from"../../ext/ol.js";import r from"../../olMap.js";var a=r.get();import i from"../../vectors.js";import n from"./serialise.htm.js";import l from"./component.js";var s=new l(n);import"./toolbar.js";o("#toolbar").appendChild(s.getTemplate("serialise"));var c,m="GeoJSON";function p(e,r,n){m=o("#opformat").value;var l=i.getFormat(m),s=i.getLayers().getArray(),p=[];s.forEach((function(o){"saveall"!=e&&o.get("id")!=r||(p=p.concat(o.get("source").getFeatures()))}));var f=o("#geoonly").checked&&"GeoJSON"==m&&1===p.length;function g(e,o,t){var r={decimals:6};return o&&(r.featureProjection=a.get("view").getProjection()),t?l.writeGeometry(e[0].getGeometry(),r):l.writeFeatures(e,r)}var v=g(p,!0,f);if(n)if(f){v=g([new t.Feature(l.readGeometry(v).simplify(n))],!1,f)}else{var d=[];(d=l.readFeatures(v)).forEach((function(e){e.setGeometry(e.getGeometry().simplify(n))})),v=g(d,!1,f)}o("#serialOP").value=v,c=r}o("#serialise-title").addEventListener("click",(function(){var e=this.nextElementSibling;e.style.display="block"==e.style.display?"none":"block"})),o("#reserialise").onclick=function(e){p(void 0,c,o("#tolerance").value)},o("#download").onclick=function(e){e.target.href="data:"+{GeoJSON:"application/vnd.geo+json",GPX:"application/gpx+xml",KML:"application/vnd.google-earth.kml+xml",mongo:"application/json"}[m]+";charset=utf-8,"+encodeURIComponent(o("#serialOP").value);var t="mongo"==m?"json":m.toLowerCase();e.target.download="myGeoData."+t};export default p;