let e,t,o={};const r=document.querySelector("map-def");function a(e,t){let o,r;switch(t[0]){case"rasters":case"r":e.rasters=[],o=t[1].split(","),o.forEach((t=>{const o=-1===t.indexOf("{")?t:JSON.parse(decodeURIComponent(t));e.rasters.push(o)}));break;case"lat":e.lat=parseFloat(t[1]);break;case"lon":e.lon=parseFloat(t[1]);break;case"zoom":case"z":e.zoom=parseFloat(t[1]);break;case"components":case"c":e.components=t[1].split(",");break;case"vectors":case"v":t[1]=t[1].replace(/\s+/g," "),r=-1!=t[1].indexOf("[")?JSON.parse(decodeURIComponent(t[1])):[t[1]],e.vectors=[],r.forEach((t=>{let o;"string"==typeof t?o={url:t,id:t}:(o={url:t.url},o.id=t.id||t.url,t.attribution&&(o.attribution=t.attribution),t.style&&(o.style=t.style),t.format&&(o.format=t.format),t.strategy&&(o.strategy=t.strategy),t.noDisplay&&(o.noDisplay=t.noDisplay)),e.vectors.push(o)}));break;default:e[t[0]]=t[1]}return e}function n(t){e=t}r?o=function(e){let t={};const o=e.children;for(let e=0;e<o.length;e++){t=a(t,[o[e].localName,o[e].innerHTML])}return t}(r):window.location.search&&(o=function(){let e,t={};return window.location.search.substring(1).split("&").forEach((o=>{e=o.split("="),t=a(t,e)})),t}()),o.lat&&o.lon&&(o.center={lat:o.lat,lon:o.lon}),o&&o.mapdef&&(t=o.mapdef),t||n(o||{projCode:"EPSG:4326"});export default{init:function(){return new Promise(((o,r)=>{t?fetch(decodeURIComponent(t)).then((e=>e.json())).then((e=>{n(e),o(e)})).catch((()=>r())):o(e)}))},get:function(){return e},set:n};