var t,e,r={},n=document.querySelector("map-def");function o(t,e){var r;switch(e[0]){case"rasters":case"r":t.rasters=[],e[1].split(",").forEach((function(e){var r=-1===e.indexOf("{")?e:JSON.parse(decodeURIComponent(e));t.rasters.push(r)}));break;case"lat":t.lat=parseFloat(e[1]);break;case"lon":t.lon=parseFloat(e[1]);break;case"zoom":case"z":t.zoom=parseFloat(e[1]);break;case"components":case"c":t.components=e[1].split(",");break;case"vectors":case"v":e[1]=e[1].replace(/\s+/g," "),r=-1!=e[1].indexOf("[")?JSON.parse(decodeURIComponent(e[1])):[e[1]],t.vectors=[],r.forEach((function(e){var r;"string"==typeof e?r={url:e,id:e}:((r={url:e.url}).id=e.id||e.url,e.attribution&&(r.attribution=e.attribution),e.style&&(r.style=e.style),e.format&&(r.format=e.format),e.strategy&&(r.strategy=e.strategy)),t.vectors.push(r)}));break;default:t[e[0]]=e[1]}return t}function a(e){t=e}n?r=function(t){for(var e={},r=t.children,n=0;n<r.length;n++){var a=[r[n].localName,r[n].innerHTML];e=o(e,a)}return e}(n):window.location.search&&(r=function(){var t,e={};return window.location.search.substring(1).split("&").forEach((function(r){t=r.split("="),e=o(e,t)})),e}()),r.lat&&r.lon&&(r.center={lat:r.lat,lon:r.lon}),r&&r.mapdef&&(e=r.mapdef),e||a(r||{projCode:"EPSG:4326"});export default{init:function(){return new Promise((function(r,n){e?fetch(decodeURIComponent(e)).then((function(t){return t.json()})).then((function(t){a(t),r(t)})).catch((function(){n()})):r(t)}))},get:function(){return t},set:a};