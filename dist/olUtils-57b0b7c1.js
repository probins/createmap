import{I as t,s as e,n as s,a as i,b as r,c as n,G as o}from"./olMap-5f1c27bb.js";import{T as a,p as h,o as l,aH as u,a3 as c,h as d}from"./size-aa14a1dc.js";import{c as _}from"./vectors-e5dcdfa8.js";const f="select";class y extends d{constructor(t,e,s,i){super(t),this.selected=e,this.deselected=s,this.mapBrowserEvent=i}}const g={};class m extends t{constructor(t){super();const n=t||{};let h;if(this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=n.condition?n.condition:e,this.addCondition_=n.addCondition?n.addCondition:s,this.removeCondition_=n.removeCondition?n.removeCondition:s,this.toggleCondition_=n.toggleCondition?n.toggleCondition:i,this.multi_=!!n.multi&&n.multi,this.filter_=n.filter?n.filter:a,this.hitTolerance_=n.hitTolerance?n.hitTolerance:0,this.style_=void 0!==n.style?n.style:function(){const t=_();return c(t[o.POLYGON],t[o.LINE_STRING]),c(t[o.GEOMETRY_COLLECTION],t[o.LINE_STRING]),function(e){return e.getGeometry()?t[e.getGeometry().getType()]:null}}(),this.features_=n.features||new r,n.layers)if("function"==typeof n.layers)h=n.layers;else{const t=n.layers;h=function(e){return u(t,e)}}else h=a;this.layerFilter_=h,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(t,e){this.featureLayerAssociation_[h(t)]=e}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(t){return this.featureLayerAssociation_[h(t)]}setHitTolerance(t){this.hitTolerance_=t}setMap(t){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(t),t?(this.features_.addEventListener(n.ADD,this.boundAddFeature_),this.features_.addEventListener(n.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(n.ADD,this.boundAddFeature_),this.features_.removeEventListener(n.REMOVE,this.boundRemoveFeature_))}addFeature_(t){const e=t.element;this.style_&&this.applySelectedStyle_(e)}removeFeature_(t){const e=t.element;this.style_&&this.restorePreviousStyle_(e)}getStyle(){return this.style_}applySelectedStyle_(t){const e=h(t);e in g||(g[e]=t.getStyle()),t.setStyle(this.style_)}restorePreviousStyle_(t){const e=this.getMap().getInteractions().getArray();for(let s=e.length-1;s>=0;--s){const i=e[s];if(i!==this&&i instanceof m&&i.getStyle()&&-1!==i.getFeatures().getArray().lastIndexOf(t))return void t.setStyle(i.getStyle())}const s=h(t);t.setStyle(g[s]),delete g[s]}removeFeatureLayerAssociation_(t){delete this.featureLayerAssociation_[h(t)]}handleEvent(t){if(!this.condition_(t))return!0;const e=this.addCondition_(t),s=this.removeCondition_(t),i=this.toggleCondition_(t),r=!e&&!s&&!i,n=t.map,o=this.getFeatures(),a=[],h=[];if(r){l(this.featureLayerAssociation_),n.forEachFeatureAtPixel(t.pixel,function(t,e){if(this.filter_(t,e))return h.push(t),this.addFeatureLayerAssociation_(t,e),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let t=o.getLength()-1;t>=0;--t){const e=o.item(t),s=h.indexOf(e);s>-1?h.splice(s,1):(o.remove(e),a.push(e))}0!==h.length&&o.extend(h)}else{n.forEachFeatureAtPixel(t.pixel,function(t,r){if(this.filter_(t,r))return!e&&!i||u(o.getArray(),t)?(s||i)&&u(o.getArray(),t)&&(a.push(t),this.removeFeatureLayerAssociation_(t)):(h.push(t),this.addFeatureLayerAssociation_(t,r)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let t=a.length-1;t>=0;--t)o.remove(a[t]);o.extend(h)}return(h.length>0||a.length>0)&&this.dispatchEvent(new y(f,h,a,t)),!0}}function p(t){return t*Math.PI/180}function v(t,e){const s=p(t[1]),i=p(e[1]),r=(i-s)/2,n=p(e[0]-t[0])/2,o=Math.sin(r)*Math.sin(r)+Math.sin(n)*Math.sin(n)*Math.cos(s)*Math.cos(i);return 12756274*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}function F(t){let e=0;for(let s=1;s<t.length;s++)e+=v(t[s-1],t[s]);return e}function L(t){return Math.abs(function(t){let e=0;const s=t.length;let i=t[s-1][0],r=t[s-1][1];for(let n=0;n<s;n++){const s=t[n][0],o=t[n][1];e+=p(s-i)*(2+Math.sin(p(r))+Math.sin(p(o))),i=s,r=o}return 6378137*e*6378137/2}(t))}function A(t,e){const s=t.clone().transform(e,"EPSG:4326");return t.getType&&"LineString"===t.getType()?s.getCoordinates():s.getLinearRing(0).getCoordinates()}export{m as S,L as a,F as g,A as t};
