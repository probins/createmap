import{bj as t,b as e,E as n,S as a,K as r,aK as i,bk as s,aB as o,bl as l,aA as c,ah as h,bm as d,R as u,f as g,d as f,aS as m,ai as p,bn as T,u as b,B as E,I as R}from"./size-aa14a1dc.js";var x={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class v extends t{constructor(t){super(),this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return e()}prepareFrame(t){return e()}renderFrame(t,n){return e()}loadedTileCallback(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n}createLoadedTileFinder(t,e,n){return function(a,r){const i=this.loadedTileCallback.bind(this,n,a);return t.forEachLoadedTile(e,a,r,i)}.bind(this)}forEachFeatureAtCoordinate(t,e,n,a,r){}getDataAtPixel(t,n,a){return e()}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){t.target.getState()===x.LOADED&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=x.LOADED&&e!=x.ERROR&&t.addEventListener(n.CHANGE,this.boundHandleImageChange_),e==x.IDLE&&(t.load(),e=t.getState()),e==x.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t.getVisible()&&t.getSourceState()==a.READY&&t.changed()}}class C extends v{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=r(),this.pixelTransform=r(),this.inversePixelTransform=r(),this.context=null,this.containerReused=!1}useContainer(t,e,n){const a=this.getLayer().getClassName();let r,s;if(t&&""===t.style.opacity&&t.className===a){const e=t.firstElementChild;e instanceof HTMLCanvasElement&&(s=e.getContext("2d"))}if(!s||0!==s.canvas.width&&s.canvas.style.transform!==e?this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1):(this.container=t,this.context=s,this.containerReused=!0),!this.container){r=document.createElement("div"),r.className=a;let t=r.style;t.position="absolute",t.width="100%",t.height="100%",s=i();const e=s.canvas;r.appendChild(e),t=e.style,t.position="absolute",t.left="0",t.transformOrigin="top left",this.container=r,this.context=s}}clip(t,e,n){const a=e.pixelRatio,r=e.size[0]*a/2,i=e.size[1]*a/2,u=e.viewState.rotation,g=s(n),f=o(n),m=l(n),p=c(n);h(e.coordinateToPixelTransform,g),h(e.coordinateToPixelTransform,f),h(e.coordinateToPixelTransform,m),h(e.coordinateToPixelTransform,p),t.save(),d(t,-u,r,i),t.beginPath(),t.moveTo(g[0]*a,g[1]*a),t.lineTo(f[0]*a,f[1]*a),t.lineTo(m[0]*a,m[1]*a),t.lineTo(p[0]*a,p[1]*a),t.clip(),d(t,u,r,i)}clipUnrotated(t,e,n){const a=s(n),r=o(n),i=l(n),d=c(n);h(e.coordinateToPixelTransform,a),h(e.coordinateToPixelTransform,r),h(e.coordinateToPixelTransform,i),h(e.coordinateToPixelTransform,d);const u=this.inversePixelTransform;h(u,a),h(u,r),h(u,i),h(u,d),t.save(),t.beginPath(),t.moveTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(d[0]),Math.round(d[1])),t.clip()}dispatchRenderEvent_(t,e,n){const a=this.getLayer();if(a.hasListener(t)){const r=new u(t,this.inversePixelTransform,n,e);a.dispatchEvent(r)}}preRender(t,e){this.dispatchRenderEvent_(g.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(g.POSTRENDER,t,e)}getRenderTransform(t,e,n,a,r,i,s){const o=r/2,l=i/2,c=a/e,h=-c,d=-t[0]+s,u=-t[1];return f(this.tempTransform,o,l,c,h,-n,d,u)}getDataAtPixel(t,e,n){const a=h(this.inversePixelTransform,t.slice()),r=this.context,i=this.getLayer().getExtent();if(i){const n=h(e.pixelToCoordinateTransform,t.slice());if(!m(i,n))return null}let s;try{const t=Math.round(a[0]),e=Math.round(a[1]),n=document.createElement("canvas"),i=n.getContext("2d");n.width=1,n.height=1,i.clearRect(0,0,1,1),i.drawImage(r.canvas,t,e,1,1,0,0,1,1),s=i.getImageData(0,0,1,1).data}catch(t){return"SecurityError"===t.name?new Uint8Array:s}return 0===s[3]?null:s}}function y(t,e,a){const r=t;if(r.src&&p){const t=r.decode();let n=!0;const i=function(){n=!1};return t.then((function(){n&&e()})).catch((function(t){n&&("EncodingError"===t.name&&"Invalid image type."===t.message?e():a())})),i}const i=[T(r,n.LOAD,e),T(r,n.ERROR,a)];return function(){i.forEach(b)}}class A extends E{constructor(t){super(),this.projection_=R(t.projection),this.attributions_=_(t.attributions),this.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,this.loading=!1,this.state_=void 0!==t.state?t.state:a.READY,this.wrapX_=void 0!==t.wrapX&&t.wrapX}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection_}getResolutions(){return e()}getState(){return this.state_}getWrapX(){return this.wrapX_}getContextOptions(){}refresh(){this.changed()}setAttributions(t){this.attributions_=_(t),this.changed()}setState(t){this.state_=t,this.changed()}}function _(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}export{C,x as I,A as S,y as l};
