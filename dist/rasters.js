import{transformExtent as e}from"./deps.js";import t from"./olMap.js";const o=t.get();import r from"./registry/components/layerswitcher.js";import s from"./registry/components/zoom.js";import{$ as i}from"./utils.js";function n(){return o.getLayers().item(0).get("layers")}function a(e){const t=document.getElementById(e.target.htmlFor)||e.target;if(!t.value)return;c.bind(this)(t.value)}function c(o){const r=this.getLayers().item(0).get("layers").getArray(),n=r.filter((function(e){return!0===e.activeLayer})),a=r.filter((function(e){return e.getProperties().id==o}));n.forEach((e=>{e.set("visible",!1),e.activeLayer=!1})),a.forEach((e=>{e.set("visible",!0),e.activeLayer=!0}));const c=a[0].get("source").getProjection(),f=c?c.getCode():"EPSG:3857",l=this.getLayers().item(1).get("layers"),u=0===l.get("length")?"":"EPSG:4326",g=n[0]?n[0].get("source").getProjection().getCode():u;if(f!=g){let o;if(""!==g){const t=this.get("view").calculateExtent();o=e(t,g,f),l.forEach((e=>{e.get("source").getFeatures().forEach((e=>{e.getGeometry().transform(g,f)}))}))}const r=i(".projcursor");r&&(r.style.display="EPSG:4326"==f?"none":""),this.set("view",t.views[f]),s.setZooms(),""!==g&&this.get("view").fit(o)}}function f(s,i){i=i||{},s.forEach(((s,c)=>{const f=(s=s.default).projCode||"EPSG:3857",l=t.views;if(!l[f])if(l[f]=t.createView(i,f,s.extent,s.resolutions),l[f].extent=s.extent||e([-180,-85,180,85],"EPSG:4326",f),l[f].zoomLevels=s.resolutions?s.resolutions.length:20,s.resolutions){const e=s.resolutions.reduce((function(e,t){return Math.abs(t-5)<Math.abs(e-5)?t:e}));l[f].zoomIn=s.resolutions.indexOf(e)}else l[f].zoomIn=15;let u,g;if(i.rasters&&"object"==typeof i.rasters[c])for(g in i.rasters[c])u=i.rasters[c][g];const m=s.getLayers({zoom:i.zoom,apikey:u});m.forEach((e=>{e.set("visible",!1),e.activeLayer=!1,n().push(e)}));r.addRasterDiv(m[0]).addEventListener("click",a.bind(o)),s.viewEvent&&l[f].on(s.viewEvent.type,s.viewEvent.func)}))}function l(){n().forEach((e=>{!0===e.activeLayer&&e.set("visible",!0)}))}export default{addInitial:function(e,r){f(e,r);const i=e[0].default.projCode||"EPSG:3857";o.set("view",t.views[i]),n().item(0).activeLayer=!0,s.setZooms(),r.vectors||l()},add:f,changeLayer:c,makeActiveLayerVisible:l,getLayers:n};