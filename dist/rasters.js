import{ol as e}from"./deps.js";import t from"./olMap.js";var r=t.get();import o from"./registry/components/layerswitcher.js";import i from"./registry/components/zoom.js";import s from"./utils.js";var n=s.$;function a(){return r.getLayers().item(0).get("layers")}function c(e){var t=document.getElementById(e.target.htmlFor)||e.target;t.value&&f.bind(this)(t.value)}function f(r){var o=this.getLayers().item(0).get("layers").getArray(),s=o.filter((function(e){return!0===e.activeLayer})),a=o.filter((function(e){return e.getProperties().id==r}));s.forEach((function(e){e.set("visible",!1),e.activeLayer=!1})),a.forEach((function(e){e.set("visible",!0),e.activeLayer=!0}));let c=a[0].get("source").getProjection();var f=c?c.getCode():"EPSG:3857",u=this.getLayers().item(1).get("layers"),v=0===u.get("length")?"":"EPSG:4326",l=s[0]?s[0].get("source").getProjection().getCode():v;if(f!=l){var m;if(""!==l){var g=this.get("view").calculateExtent();m=e.proj.transformExtent(g,l,f),u.forEach((function(e){e.get("source").getFeatures().forEach((function(e){e.getGeometry().transform(l,f)}))}))}var y=n(".projcursor");y&&(y.style.display="EPSG:4326"==f?"none":""),this.set("view",t.views[f]),i.setZooms(),""!==l&&this.get("view").fit(m)}}function u(i,s){s=s||{},i.forEach((function(i,n){var f,u,v=(i=i.default).projCode||"EPSG:3857",l=t.views;if(!l[v])if(l[v]=t.createView(s,v,i.extent,i.resolutions),l[v].extent=i.extent||e.proj.transformExtent([-180,-85,180,85],"EPSG:4326",v),l[v].zoomLevels=i.resolutions?i.resolutions.length:20,i.resolutions){var m=i.resolutions.reduce((function(e,t){return Math.abs(t-5)<Math.abs(e-5)?t:e}));l[v].zoomIn=i.resolutions.indexOf(m)}else l[v].zoomIn=15;if(s.rasters&&"object"==typeof s.rasters[n])for(u in s.rasters[n])f=s.rasters[n][u];var g=i.getLayers({zoom:s.zoom,apikey:f});g.forEach((function(e){e.set("visible",!1),e.activeLayer=!1,a().push(e)})),o.addRasterDiv(g[0]).addEventListener("click",c.bind(r)),i.viewEvent&&l[v].on(i.viewEvent.type,i.viewEvent.func)}))}function v(){a().forEach((function(e){!0===e.activeLayer&&e.set("visible",!0)}))}export default{addInitial:function(e,o){u(e,o);var s=e[0].default.projCode||"EPSG:3857";r.set("view",t.views[s]),a().item(0).activeLayer=!0,i.setZooms(),o.vectors||v()},add:u,changeLayer:f,makeActiveLayerVisible:v,getLayers:a};