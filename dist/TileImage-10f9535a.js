import{a as t,br as e,bk as i,ag as s,aJ as n,b5 as r,w as o,c as l,aR as a,k as h,z as c,v as u,a6 as g,q as d,p as _,d as m,bs as T,m as f,_ as p,ah as x,al as E,s as C,E as F,b as R,bt as S,aK as P,J as w,g as v,aB as y,bl as j,aA as b,bu as M,bv as I,bq as z,a0 as O,a8 as X,b9 as Y,aE as G,at as L,aS as A,be as D,x as Z,bw as W,M as k,Z as U,l as K,u as q,bx as N,I as Q,af as H,U as J,by as B,bz as V,bf as $,bA as tt,h as et}from"./size-aa14a1dc.js";import{C as it,l as st,S as nt}from"./Source-441004cf.js";class rt{constructor(t,e,i,s){this.minX=t,this.maxX=e,this.minY=i,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function ot(t,e,i,s,n){return void 0!==n?(n.minX=t,n.maxX=e,n.minY=i,n.maxY=s,n):new rt(t,e,i,s)}function lt(t,e,i,s){return void 0!==s?(s[0]=t,s[1]=e,s[2]=i,s):[t,e,i]}function at(t,e,i){return t+"/"+e+"/"+i}function ht(t){return at(t[0],t[1],t[2])}function ct(t){return(t[1]<<t[0])+t[2]}const ut=[0,0,0];class gt{constructor(n){let r;if(this.minZoom=void 0!==n.minZoom?n.minZoom:0,this.resolutions_=n.resolutions,t(e(this.resolutions_,(function(t,e){return e-t}),!0),17),!n.origins)for(let t=0,e=this.resolutions_.length-1;t<e;++t)if(r){if(this.resolutions_[t]/this.resolutions_[t+1]!==r){r=void 0;break}}else r=this.resolutions_[t]/this.resolutions_[t+1];this.zoomFactor_=r,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==n.origin?n.origin:null,this.origins_=null,void 0!==n.origins&&(this.origins_=n.origins,t(this.origins_.length==this.resolutions_.length,20));const o=n.extent;void 0===o||this.origin_||this.origins_||(this.origin_=i(o)),t(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==n.tileSizes&&(this.tileSizes_=n.tileSizes,t(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==n.tileSize?n.tileSize:this.tileSizes_?null:s,t(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==o?o:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],void 0!==n.sizes?this.fullTileRanges_=n.sizes.map((function(t,e){const i=new rt(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(o){const t=this.getTileRangeForExtentAndZ(o,e);i.minX=Math.max(t.minX,i.minX),i.maxX=Math.min(t.maxX,i.maxX),i.minY=Math.max(t.minY,i.minY),i.maxY=Math.min(t.maxY,i.maxY)}return i}),this):o&&this.calculateTileRanges_(o)}forEachTileCoord(t,e,i){const s=this.getTileRangeForExtentAndZ(t,e);for(let t=s.minX,n=s.maxX;t<=n;++t)for(let n=s.minY,r=s.maxY;n<=r;++n)i([e,t,n])}forEachTileCoordParentTileRange(t,e,i,s){let n,r,o,l=null,a=t[0]-1;for(2===this.zoomFactor_?(r=t[1],o=t[2]):l=this.getTileCoordExtent(t,s);a>=this.minZoom;){if(2===this.zoomFactor_?(r=Math.floor(r/2),o=Math.floor(o/2),n=ot(r,r,o,o,i)):n=this.getTileRangeForExtentAndZ(l,a,i),e(a,n))return!0;--a}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){const i=2*t[1],s=2*t[2];return ot(i,i+1,s,s+1,e)}const s=this.getTileCoordExtent(t,i);return this.getTileRangeForExtentAndZ(s,t[0]+1,e)}return null}getTileRangeExtent(t,e,i){const s=this.getOrigin(t),o=this.getResolution(t),l=n(this.getTileSize(t),this.tmpSize_),a=s[0]+e.minX*l[0]*o,h=s[0]+(e.maxX+1)*l[0]*o,c=s[1]+e.minY*l[1]*o,u=s[1]+(e.maxY+1)*l[1]*o;return r(a,c,h,u,i)}getTileRangeForExtentAndZ(t,e,i){const s=ut;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,s);const n=s[1],r=s[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,s),ot(n,s[1],r,s[2],i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),s=n(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*s[0]*i,e[1]-(t[2]+.5)*s[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),s=this.getResolution(t[0]),o=n(this.getTileSize(t[0]),this.tmpSize_),l=i[0]+t[1]*o[0]*s,a=i[1]-(t[2]+1)*o[1]*s,h=l+o[0]*s,c=a+o[1]*s;return r(l,a,h,c,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,s,r){const o=this.getZForResolution(i),l=i/this.getResolution(o),a=this.getOrigin(o),h=n(this.getTileSize(o),this.tmpSize_),c=s?.5:0,u=s?.5:0,g=Math.floor((t-a[0])/i+c),d=Math.floor((a[1]-e)/i+u);let _=l*g/h[0],m=l*d/h[1];return s?(_=Math.ceil(_)-1,m=Math.ceil(m)-1):(_=Math.floor(_),m=Math.floor(m)),lt(o,_,m,r)}getTileCoordForXYAndZ_(t,e,i,s,r){const o=this.getOrigin(i),l=this.getResolution(i),a=n(this.getTileSize(i),this.tmpSize_),h=s?.5:0,c=s?.5:0,u=Math.floor((t-o[0])/l+h),g=Math.floor((o[1]-e)/l+c);let d=u/a[0],_=g/a[1];return s?(d=Math.ceil(d)-1,_=Math.ceil(_)-1):(d=Math.floor(d),_=Math.floor(_)),lt(i,d,_,r)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=o(this.resolutions_,t,e||0);return l(i,this.minZoom,this.maxZoom)}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let s=this.minZoom;s<e;++s)i[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=i}}var dt="preload",_t="useInterimTilesOnError";class mt extends a{constructor(t){const e=t||{},i=h({},e);delete i.preload,delete i.useInterimTilesOnError,super(i),this.setPreload(void 0!==e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError)}getPreload(){return this.get(dt)}setPreload(t){this.set(dt,t)}getUseInterimTilesOnError(){return this.get(_t)}setUseInterimTilesOnError(t){this.set(_t,t)}}class Tt extends it{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=c(),this.tmpTileRange_=new rt(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),s=e.getUseInterimTilesOnError();return i==u.LOADED||i==u.EMPTY||i==u.ERROR&&!s}getTile(t,e,i,s){const n=s.pixelRatio,r=s.viewState.projection,o=this.getLayer();let l=o.getSource().getTile(t,e,i,n,r);return l.getState()==u.ERROR&&(o.getUseInterimTilesOnError()?o.getPreload()>0&&(this.newTiles_=!0):l.setState(u.LOADED)),this.isDrawableTile(l)||(l=l.getInterimTile()),l}loadedTileCallback(t,e,i){return!!this.isDrawableTile(i)&&super.loadedTileCallback(t,e,i)}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const s=t.layerStatesArray[t.layerIndex],n=t.viewState,r=n.projection,o=n.resolution,l=n.center,a=n.rotation,c=t.pixelRatio,C=this.getLayer(),F=C.getSource(),R=F.getRevision(),S=F.getTileGridForProjection(r),P=S.getZForResolution(o,F.zDirection),w=S.getResolution(P);let v=t.extent;const y=s.extent&&g(s.extent);y&&(v=d(v,g(s.extent)));const j=F.getTilePixelRatio(c);let b=Math.round(t.size[0]*j),M=Math.round(t.size[1]*j);if(a){const t=Math.round(Math.sqrt(b*b+M*M));b=t,M=t}const I=w*b/2/j,z=w*M/2/j,O=[l[0]-I,l[1]-z,l[0]+I,l[1]+z],X=S.getTileRangeForExtentAndZ(v,P),Y={};Y[P]={};const G=this.createLoadedTileFinder(F,r,Y),L=this.tmpExtent,A=this.tmpTileRange_;this.newTiles_=!1;for(let e=X.minX;e<=X.maxX;++e)for(let i=X.minY;i<=X.maxY;++i){const s=this.getTile(P,e,i,t);if(this.isDrawableTile(s)){const e=_(this);if(s.getState()==u.LOADED){Y[P][s.tileCoord.toString()]=s;const t=s.inTransition(e);this.newTiles_||!t&&-1!==this.renderedTiles.indexOf(s)||(this.newTiles_=!0)}if(1===s.getAlpha(e,t.time))continue}const n=S.getTileCoordChildTileRange(s.tileCoord,A,L);let r=!1;n&&(r=G(P+1,n)),r||S.forEachTileCoordParentTileRange(s.tileCoord,G,A,L)}const D=w/o;m(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/j,1/j,a,-b/2,-M/2);const Z=T(this.pixelTransform);this.useContainer(e,Z,s.opacity);const W=this.context,k=W.canvas;f(this.inversePixelTransform,this.pixelTransform),m(this.tempTransform,b/2,M/2,D,D,0,-b/2,-M/2),k.width!=b||k.height!=M?(k.width=b,k.height=M):this.containerReused||W.clearRect(0,0,b,M),y&&this.clipUnrotated(W,t,y),h(W,F.getContextOptions()),this.preRender(W,t),this.renderedTiles.length=0;let U,K,q,N=Object.keys(Y).map(Number);N.sort(p),1!==s.opacity||this.containerReused&&!F.getOpaque(t.viewState.projection)?(U=[],K=[]):N=N.reverse();for(let e=N.length-1;e>=0;--e){const n=N[e],o=F.getTilePixelSize(n,c,r),l=S.getResolution(n)/w,a=o[0]*l*D,h=o[1]*l*D,u=S.getTileCoordForCoordAndZ(i(O),n),g=S.getTileCoordExtent(u),d=x(this.tempTransform,[j*(g[0]-O[0])/w,j*(O[3]-g[3])/w]),m=j*F.getGutterForProjection(r),T=Y[n];for(const e in T){const i=T[e],r=i.tileCoord,o=d[0]-(u[1]-r[1])*a,l=Math.round(o+a),c=d[1]-(u[2]-r[2])*h,g=Math.round(c+h),f=Math.round(o),p=Math.round(c),x=l-f,E=g-p,C=P===n,R=C&&1!==i.getAlpha(_(this),t.time);if(!R)if(U){W.save(),q=[f,p,f+x,p,f+x,p+E,f,p+E];for(let t=0,e=U.length;t<e;++t)if(P!==n&&n<K[t]){const e=U[t];W.beginPath(),W.moveTo(q[0],q[1]),W.lineTo(q[2],q[3]),W.lineTo(q[4],q[5]),W.lineTo(q[6],q[7]),W.moveTo(e[6],e[7]),W.lineTo(e[4],e[5]),W.lineTo(e[2],e[3]),W.lineTo(e[0],e[1]),W.clip()}U.push(q),K.push(n)}else W.clearRect(f,p,x,E);this.drawTileImage(i,t,f,p,x,E,m,C,s.opacity),U&&!R&&W.restore(),this.renderedTiles.push(i),this.updateUsedTiles(t.usedTiles,F,i)}}return this.renderedRevision=R,this.renderedResolution=w,this.extentChanged=!this.renderedExtent_||!E(this.renderedExtent_,O),this.renderedExtent_=O,this.renderedPixelRatio=c,this.renderedProjection=r,this.manageTilePyramid(t,F,S,c,r,v,P,C.getPreload()),this.scheduleExpireCache(t,F),this.postRender(W,t),s.extent&&W.restore(),Z!==k.style.transform&&(k.style.transform=Z),this.container}drawTileImage(t,e,i,s,n,r,o,l,a){const h=this.getTileImage(t);if(!h)return;const c=_(this),u=l?t.getAlpha(c,e.time):1,g=a*u,d=g!==this.context.globalAlpha;d&&(this.context.save(),this.context.globalAlpha=g),this.context.drawImage(h,o,o,h.width-2*o,h.height-2*o,i,s,n,r),d&&this.context.restore(),1!==u?e.animate=!0:l&&t.endTransition(c)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=function(t,e,i){const s=_(t);s in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[s])}.bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const s=_(e);s in t||(t[s]={}),t[s][i.getKey()]=!0}manageTilePyramid(t,e,i,s,n,r,o,l,a){const h=_(e);h in t.wantedTiles||(t.wantedTiles[h]={});const c=t.wantedTiles[h],g=t.tileQueue;let d,m,T,f,p,x,E=0;for(x=i.getMinZoom();x<=o;++x)for(m=i.getTileRangeForExtentAndZ(r,x,m),T=i.getResolution(x),f=m.minX;f<=m.maxX;++f)for(p=m.minY;p<=m.maxY;++p)o-x<=l?(++E,d=e.getTile(x,f,p,s,n),d.getState()==u.IDLE&&(c[d.getKey()]=!0,g.isKeyQueued(d.getKey())||g.enqueue([d,h,i.getTileCoordCenter(d.tileCoord),T])),void 0!==a&&a(d)):e.useTile(x,f,p,n);e.updateCacheSize(E,n)}}class ft extends mt{constructor(t){super(t)}createRenderer(){return new Tt(this)}}class pt extends C{constructor(t,e,i){super();const s=i||{};this.tileCoord=t,this.state=e,this.interimTile=null,this.hifi=!0,this.key="",this.transition_=void 0===s.transition?250:s.transition,this.transitionStarts_={}}changed(){this.dispatchEvent(F.CHANGE)}release(){}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==u.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(t.getState()==u.LOADED){t.interimTile=null;break}t.getState()==u.LOADING?e=t:t.getState()==u.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==u.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){R()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;const s=e-i+1e3/60;return s>=this.transition_?1:S(s/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}class xt extends pt{constructor(t,e,i,s,n,r){super(t,e,r),this.crossOrigin_=s,this.src_=i,this.key=i,this.image_=new Image,null!==s&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=n}getImage(){return this.image_}handleImageError_(){this.state=u.ERROR,this.unlistenImage_(),this.image_=function(){const t=P(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=u.LOADED:this.state=u.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==u.ERROR&&(this.state=u.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==u.IDLE&&(this.state=u.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=st(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}class Et{constructor(t,e,s,n,r,o){this.sourceProj_=t,this.targetProj_=e;let l={};const a=w(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){const e=t[0]+"/"+t[1];return l[e]||(l[e]=a(t)),l[e]},this.maxSourceExtent_=n,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&v(n)==v(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?v(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?v(this.targetProj_.getExtent()):null;const h=i(s),c=y(s),u=j(s),g=b(s),d=this.transformInv_(h),_=this.transformInv_(c),m=this.transformInv_(u),T=this.transformInv_(g),f=10+(o?Math.max(0,Math.ceil(M(I(s)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,g,d,_,m,T,f),this.wrapsXInSource_){let t=1/0;this.triangles_.forEach((function(e,i,s){t=Math.min(t,e.source[0][0],e.source[1][0],e.source[2][0])})),this.triangles_.forEach(function(e){if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-t>this.sourceWorldWidth_/2){const i=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];i[0][0]-t>this.sourceWorldWidth_/2&&(i[0][0]-=this.sourceWorldWidth_),i[1][0]-t>this.sourceWorldWidth_/2&&(i[1][0]-=this.sourceWorldWidth_),i[2][0]-t>this.sourceWorldWidth_/2&&(i[2][0]-=this.sourceWorldWidth_);const s=Math.min(i[0][0],i[1][0],i[2][0]);Math.max(i[0][0],i[1][0],i[2][0])-s<this.sourceWorldWidth_/2&&(e.source=i)}}.bind(this))}l={}}addTriangle_(t,e,i,s,n,r){this.triangles_.push({source:[s,n,r],target:[t,e,i]})}addQuad_(t,e,i,s,n,r,o,l,a){const h=z([n,r,o,l]),c=this.sourceWorldWidth_?v(h)/this.sourceWorldWidth_:null,u=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&c>.5&&c<1;let d=!1;if(a>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const n=z([t,e,i,s]);d=v(n)/this.targetWorldWidth_>.25||d}!g&&this.sourceProj_.isGlobal()&&c&&(d=c>.25||d)}if(!d&&this.maxSourceExtent_&&isFinite(h[0])&&isFinite(h[1])&&isFinite(h[2])&&isFinite(h[3])&&!O(h,this.maxSourceExtent_))return;let _=0;if(!(d||isFinite(n[0])&&isFinite(n[1])&&isFinite(r[0])&&isFinite(r[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(l[0])&&isFinite(l[1])))if(a>0)d=!0;else if(_=(isFinite(n[0])&&isFinite(n[1])?0:8)+(isFinite(r[0])&&isFinite(r[1])?0:4)+(isFinite(o[0])&&isFinite(o[1])?0:2)+(isFinite(l[0])&&isFinite(l[1])?0:1),1!=_&&2!=_&&4!=_&&8!=_)return;if(a>0){if(!d){const e=[(t[0]+i[0])/2,(t[1]+i[1])/2],s=this.transformInv_(e);let r;if(g){r=(X(n[0],u)+X(o[0],u))/2-X(s[0],u)}else r=(n[0]+o[0])/2-s[0];const l=(n[1]+o[1])/2-s[1];d=r*r+l*l>this.errorThresholdSquared_}if(d){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const h=[(e[0]+i[0])/2,(e[1]+i[1])/2],c=this.transformInv_(h),u=[(s[0]+t[0])/2,(s[1]+t[1])/2],g=this.transformInv_(u);this.addQuad_(t,e,h,u,n,r,c,g,a-1),this.addQuad_(u,h,i,s,g,c,o,l,a-1)}else{const h=[(t[0]+e[0])/2,(t[1]+e[1])/2],c=this.transformInv_(h),u=[(i[0]+s[0])/2,(i[1]+s[1])/2],g=this.transformInv_(u);this.addQuad_(t,h,u,s,n,c,g,l,a-1),this.addQuad_(h,e,i,u,c,r,o,g,a-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&_)&&this.addTriangle_(t,i,s,n,o,l),0==(14&_)&&this.addTriangle_(t,i,e,n,o,r),_&&(0==(13&_)&&this.addTriangle_(e,s,t,r,l,n),0==(7&_)&&this.addTriangle_(e,s,i,r,l,o))}calculateSourceExtent(){const t=c();return this.triangles_.forEach((function(e,i,s){const n=e.source;Y(t,n[0]),Y(t,n[1]),Y(t,n[2])})),t}getTriangles(){return this.triangles_}}const Ct="1.3.0",Ft={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1};let Rt;function St(t,e,i,s,n){t.beginPath(),t.moveTo(0,0),t.lineTo(e,i),t.lineTo(s,n),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,s)+1,Math.max(i,n)),t.restore()}function Pt(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function wt(t,e,i,s){const n=G(i,e,t);let r=L(e,s,i);const o=e.getMetersPerUnit();void 0!==o&&(r*=o);const l=t.getMetersPerUnit();void 0!==l&&(r/=l);const a=t.getExtent();if(!a||A(a,n)){const e=L(t,r,n)/r;isFinite(e)&&e>0&&(r/=e)}return r}function vt(t,e,s,n,r,o,l,a,u,g,d,_){const m=P(Math.round(s*t),Math.round(s*e));if(h(m,_),0===u.length)return m.canvas;function T(t){return Math.round(t*s)/s}m.scale(s,s),m.globalCompositeOperation="lighter";const f=c();u.forEach((function(t,e,i){D(f,t.extent)}));const p=v(f),x=Z(f),E=P(Math.round(s*p/n),Math.round(s*x/n));h(E,_);const C=s/n;u.forEach((function(t,e,i){const s=t.extent[0]-f[0],n=-(t.extent[3]-f[3]),r=v(t.extent),o=Z(t.extent);t.image.width>0&&t.image.height>0&&E.drawImage(t.image,g,g,t.image.width-2*g,t.image.height-2*g,s*C,n*C,r*C,o*C)}));const F=i(l);return a.getTriangles().forEach((function(t,e,i){const r=t.source,l=t.target;let a=r[0][0],h=r[0][1],c=r[1][0],u=r[1][1],g=r[2][0],d=r[2][1];const p=T((l[0][0]-F[0])/o),x=T(-(l[0][1]-F[1])/o),C=T((l[1][0]-F[0])/o),R=T(-(l[1][1]-F[1])/o),S=T((l[2][0]-F[0])/o),P=T(-(l[2][1]-F[1])/o),w=a,v=h;a=0,h=0,c-=w,u-=v,g-=w,d-=v;const y=W([[c,u,0,0,C-p],[g,d,0,0,S-p],[0,0,c,u,R-x],[0,0,g,d,P-x]]);if(y){if(m.save(),m.beginPath(),function(){if(void 0===Rt){const t=document.createElement("canvas").getContext("2d");t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",St(t,4,5,4,0),St(t,4,5,0,5);const e=t.getImageData(0,0,3,3).data;Rt=Pt(e,0)||Pt(e,4)||Pt(e,8)}return Rt}()||_===Ft){m.moveTo(C,R);const t=4,e=p-C,i=x-R;for(let s=0;s<t;s++)m.lineTo(C+T((s+1)*e/t),R+T(s*i/(t-1))),s!=t-1&&m.lineTo(C+T((s+1)*e/t),R+T((s+1)*i/(t-1)));m.lineTo(S,P)}else m.moveTo(C,R),m.lineTo(p,x),m.lineTo(S,P);m.clip(),m.transform(y[0],y[2],y[1],y[3],p,x),m.translate(f[0]-w,f[3]-v),m.scale(n/s,-n/s),m.drawImage(E.canvas,0,0),m.restore()}})),d&&(m.save(),m.globalCompositeOperation="source-over",m.strokeStyle="black",m.lineWidth=1,a.getTriangles().forEach((function(t,e,i){const s=t.target,n=(s[0][0]-F[0])/o,r=-(s[0][1]-F[1])/o,l=(s[1][0]-F[0])/o,a=-(s[1][1]-F[1])/o,h=(s[2][0]-F[0])/o,c=-(s[2][1]-F[1])/o;m.beginPath(),m.moveTo(l,a),m.lineTo(n,r),m.lineTo(h,c),m.closePath(),m.stroke()})),m.restore()),m.canvas}class yt extends pt{constructor(t,e,i,s,n,r,o,a,h,c,g,_){super(n,u.IDLE),this.renderEdges_=void 0!==g&&g,this.contextOptions_=_,this.pixelRatio_=o,this.gutter_=a,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=s,this.wrappedTileCoord_=r||n,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const m=s.getTileCoordExtent(this.wrappedTileCoord_),T=this.targetTileGrid_.getExtent();let f=this.sourceTileGrid_.getExtent();const p=T?d(m,T):m;if(0===I(p))return void(this.state=u.EMPTY);const x=t.getExtent();x&&(f=f?d(f,x):x);const E=s.getResolution(this.wrappedTileCoord_[0]),C=function(t,e,i,s){const n=k(i);let r=wt(t,e,n,s);return(!isFinite(r)||r<=0)&&U(i,(function(i){return r=wt(t,e,i,s),isFinite(r)&&r>0})),r}(t,i,p,E);if(!isFinite(C)||C<=0)return void(this.state=u.EMPTY);const F=void 0!==c?c:.5;if(this.triangulation_=new Et(t,i,p,f,C*F,E),0===this.triangulation_.getTriangles().length)return void(this.state=u.EMPTY);this.sourceZ_=e.getZForResolution(C);let R=this.triangulation_.calculateSourceExtent();if(f&&(t.canWrapX()?(R[1]=l(R[1],f[1],f[3]),R[3]=l(R[3],f[1],f[3])):R=d(R,f)),I(R)){const t=e.getTileRangeForExtentAndZ(R,this.sourceZ_);for(let e=t.minX;e<=t.maxX;e++)for(let i=t.minY;i<=t.maxY;i++){const t=h(this.sourceZ_,e,i,o);t&&this.sourceTiles_.push(t)}0===this.sourceTiles_.length&&(this.state=u.EMPTY)}else this.state=u.EMPTY}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(function(e,i,s){e&&e.getState()==u.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=u.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),s="number"==typeof i?i:i[0],n="number"==typeof i?i:i[1],r=this.targetTileGrid_.getResolution(e),o=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=vt(s,n,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),r,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.contextOptions_),this.state=u.LOADED}this.changed()}load(){if(this.state==u.IDLE){this.state=u.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,i,s){const n=e.getState();if(n==u.IDLE||n==u.LOADING){t++;const i=K(e,F.CHANGE,(function(s){const n=e.getState();n!=u.LOADED&&n!=u.ERROR&&n!=u.EMPTY||(q(i),t--,0===t&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(i)}}.bind(this)),this.sourceTiles_.forEach((function(t,e,i){t.getState()==u.IDLE&&t.load()})),0===t&&setTimeout(this.reproject_.bind(this),0)}}unlistenSources_(){this.sourcesListenerKeys_.forEach(q),this.sourcesListenerKeys_=null}}class jt extends class{constructor(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(e,i){const s=this.entries_[e];return t(void 0!==s,15),s===this.newest_||(s===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(s.newer.older=s.older,s.older.newer=s.newer),s.newer=null,s.older=this.newest_,this.newest_.newer=s,this.newest_=s),s.value_}remove(e){const i=this.entries_[e];return t(void 0!==i,15),i===this.newest_?(this.newest_=i.older,this.newest_&&(this.newest_.newer=null)):i===this.oldest_?(this.oldest_=i.newer,this.oldest_&&(this.oldest_.older=null)):(i.newer.older=i.older,i.older.newer=i.newer),delete this.entries_[e],--this.count_,i.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.key_;return t}getValues(){const t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(e,i){t(!(e in this.entries_),16);const s={key_:e,newer:null,older:this.newest_,value_:i};this.newest_?this.newest_.newer=s:this.oldest_=s,this.newest_=s,this.entries_[e]=s,++this.count_}setSize(t){this.highWaterMark=t}}{expireCache(t){for(;this.canExpireCache();){if(this.peekLast().getKey()in t)break;this.pop().release()}}pruneExceptNewestZ(){if(0===this.getCount())return;const t=function(t){return t.split("/").map(Number)}(this.peekFirstKey())[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove(ht(e.tileCoord)),e.release())}.bind(this))}}var bt="tileloadstart",Mt="tileloadend",It="tileloaderror";function zt(t){let e=t.getDefaultTileGrid();return e||(e=function(t,e,i,s){return function(t,e,i,s){const n=void 0!==s?s:B.TOP_LEFT,r=Xt(t,e,i);return new gt({extent:t,origin:N(t,n),resolutions:r,tileSize:i})}(Yt(t),e,i,s)}(t),t.setDefaultTileGrid(e)),e}function Ot(t){const e=t||{},i=e.extent||Q("EPSG:3857").getExtent(),s={extent:i,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Xt(i,e.maxZoom,e.tileSize,e.maxResolution)};return new gt(s)}function Xt(t,e,i,r){const o=void 0!==e?e:V,l=Z(t),a=v(t),h=n(void 0!==i?i:s),c=r>0?r:Math.max(a/h[0],l/h[1]),u=o+1,g=new Array(u);for(let t=0;t<u;++t)g[t]=c/Math.pow(2,t);return g}function Yt(t){let e=(t=Q(t)).getExtent();if(!e){const i=180*H[J.DEGREES]/t.getMetersPerUnit();e=r(-i,-i,i,i)}return e}class Gt extends nt{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX}),this.opaque_=void 0!==t.opaque&&t.opaque,this.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;const e=[256,256],i=t.tileGrid;i&&n(i.getTileSize(i.getMinZoom()),e),this.tileCache=new jt(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,s){const n=this.getTileCacheForProjection(t);if(!n)return!1;let r,o,l,a=!0;for(let t=i.minX;t<=i.maxX;++t)for(let h=i.minY;h<=i.maxY;++h)o=at(e,t,h),l=!1,n.containsKey(o)&&(r=n.get(o),l=r.getState()===u.LOADED,l&&(l=!1!==s(r))),l||(a=!1);return a}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(){return this.tileGrid.getResolutions()}getTile(t,e,i,s,n){return R()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:zt(t)}getTileCacheForProjection(e){return t($(this.getProjection(),e),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const s=this.getTileGridForProjection(i),r=this.getTilePixelRatio(e),o=n(s.getTileSize(t),this.tmpSize);return 1==r?o:tt(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){const i=void 0!==e?e:this.getProjection(),s=this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(t=function(t,e,i){const s=e[0],n=t.getTileCoordCenter(e),r=Yt(i);if(A(r,n))return e;{const e=v(r),i=Math.ceil((r[0]-n[0])/e);return n[0]+=e*i,t.getTileCoordForCoordAndZ(n,s)}}(s,t,i)),function(t,e){const i=t[0],s=t[1],n=t[2];if(e.getMinZoom()>i||i>e.getMaxZoom())return!1;const r=e.getFullTileRange(i);return!r||r.containsXY(s,n)}(t,s)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,s){}}class Lt extends et{constructor(t,e){super(t),this.tile=e}}function At(e,i){const s=/\{z\}/g,n=/\{x\}/g,r=/\{y\}/g,o=/\{-y\}/g;return function(l,a,h){return l?e.replace(s,l[0].toString()).replace(n,l[1].toString()).replace(r,l[2].toString()).replace(o,(function(){const e=l[0],s=i.getFullTileRange(e);t(s,55);return(s.getHeight()-l[2]-1).toString()})):void 0}}function Dt(t){return 1===t.length?t[0]:function(e,i,s){if(e){const n=ct(e),r=X(n,t.length);return t[r](e,i,s)}}}function Zt(t){const e=[];let i=/\{([a-z])-([a-z])\}/.exec(t);if(i){const s=i[1].charCodeAt(0),n=i[2].charCodeAt(0);let r;for(r=s;r<=n;++r)e.push(t.replace(i[0],String.fromCharCode(r)));return e}if(i=/\{(\d+)-(\d+)\}/.exec(t),i){const s=parseInt(i[2],10);for(let n=parseInt(i[1],10);n<=s;n++)e.push(t.replace(i[0],n.toString()));return e}return e.push(t),e}class Wt extends Gt{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Wt.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=_(e),s=e.getState();let n;s==u.LOADING?(this.tileLoadingKeys_[i]=!0,n=bt):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],n=s==u.ERROR?It:s==u.LOADED?Mt:void 0),null!=n&&this.dispatchEvent(new Lt(n,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()}setUrl(t){const e=Zt(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(t,e){const i=t.length,s=new Array(i);for(let n=0;n<i;++n)s[n]=At(t[n],e);return Dt(s)}(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const s=at(t,e,i);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}class kt extends Wt{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Ut,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,this.tileClass=void 0!==t.tileClass?t.tileClass:xt,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.contextOptions_=!1===t.imageSmoothing?Ft:void 0,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const t in this.tileCacheForProjection){const s=this.tileCacheForProjection[t];s.expireCache(s==i?e:{})}}getContextOptions(){return this.contextOptions_}getGutterForProjection(t){return this.getProjection()&&t&&!$(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){return super.getKey()+(this.contextOptions_?"\n"+JSON.stringify(this.contextOptions_):"")}getOpaque(t){return!(this.getProjection()&&t&&!$(this.getProjection(),t))&&super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(!this.tileGrid||e&&!$(e,t)){const e=_(t);return e in this.tileGridForProjection||(this.tileGridForProjection[e]=zt(t)),this.tileGridForProjection[e]}return this.tileGrid}getTileCacheForProjection(t){const e=this.getProjection();if(!e||$(e,t))return this.tileCache;{const e=_(t);return e in this.tileCacheForProjection||(this.tileCacheForProjection[e]=new jt(this.tileCache.highWaterMark)),this.tileCacheForProjection[e]}}createTile_(t,e,i,s,n,r){const o=[t,e,i],l=this.getTileCoordForTileUrlFunction(o,n),a=l?this.tileUrlFunction(l,s,n):void 0,h=new this.tileClass(o,void 0!==a?u.IDLE:u.EMPTY,void 0!==a?a:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=r,h.addEventListener(F.CHANGE,this.handleTileChange.bind(this)),h}getTile(t,e,i,s,n){const r=this.getProjection();if(r&&n&&!$(r,n)){const o=this.getTileCacheForProjection(n),l=[t,e,i];let a;const h=ht(l);o.containsKey(h)&&(a=o.get(h));const c=this.getKey();if(a&&a.key==c)return a;{const t=this.getTileGridForProjection(r),e=this.getTileGridForProjection(n),i=this.getTileCoordForTileUrlFunction(l,n),u=new yt(r,t,n,e,l,i,this.getTilePixelRatio(s),this.getGutter(),function(t,e,i,s){return this.getTileInternal(t,e,i,s,r)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.contextOptions_);return u.key=c,a?(u.interimTile=a,u.refreshInterimChain(),o.replace(h,u)):o.set(h,u),u}}return this.getTileInternal(t,e,i,s,r||n)}getTileInternal(t,e,i,s,n){let r=null;const o=at(t,e,i),l=this.getKey();if(this.tileCache.containsKey(o)){if(r=this.tileCache.get(o),r.key!=l){const a=r;r=this.createTile_(t,e,i,s,n,l),a.getState()==u.IDLE?r.interimTile=a.interimTile:r.interimTile=a,r.refreshInterimChain(),this.tileCache.replace(o,r)}}else r=this.createTile_(t,e,i,s,n,l),this.tileCache.set(o,r);return r}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(t,e){{const i=Q(t);if(i){const t=_(i);t in this.tileGridForProjection||(this.tileGridForProjection[t]=e)}}}}function Ut(t,e){t.getImage().src=e}export{Ct as D,gt as T,kt as a,ft as b,Dt as c,Yt as d,Zt as e,Ot as f,lt as g,wt as h,ct as i};
